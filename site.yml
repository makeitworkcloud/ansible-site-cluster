#!/usr/bin/env ansible-playbook
---
- name: Load SOPS values
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Load vars task
      community.sops.load_vars:
        file: secrets/secrets.yaml

- name: Deploy OpenShift Local (crc) with GitOps + KSOPS
  hosts: all
  gather_facts: true
  roles:
    - role: crc
      vars:
        crc_gitops_age_keys: "{{ hostvars['localhost']['age_keys'] }}"
        crc_gitops_repo_url: https://github.com/makeitworkcloud/gitops-cluster.git
        crc_gitops_repo_branch: main
        crc_gitops_bootstrap_path: bootstrap
        crc_gitops_workloads_path: workloads
